<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Header Overlay â€” Mario</title>
    <link rel="stylesheet" href="../../css/header-structure.css">
    <style>
        /* ===== MARIO THEME CSS ===== */
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        :root {
            --theme-font: 'Press Start 2P', cursive;
            --mario-black: #000000;
            --mario-blue: #049CD8;
            --mario-yellow: #FBD000;
            --mario-red: #E52521;
            --mario-green: #43B047;
            --color-gold: var(--mario-yellow);
            --color-question: var(--mario-yellow);
            --color-question-dark: #c49800;
            --color-blue: var(--mario-blue);
            --color-blue-dark: #037ba8;
            --border-width: 4px;
            --border-radius: 8px;
            --shadow-color: rgba(0, 0, 0, 0.5);
        }

        body { font-family: var(--theme-font); }

        /* Question Block style for Event/Heat boxes */
        .header-box.fixed .header-content {
            background: linear-gradient(180deg, var(--color-question) 0%, #ff8800 50%, var(--color-question-dark) 100%);
            border: var(--border-width) solid #000;
            border-radius: var(--border-radius);
            box-shadow:
                inset 0 -4px 0 rgba(0,0,0,0.3),
                inset 4px 4px 0 rgba(255,255,255,0.3),
                0 4px 8px var(--shadow-color);
        }

        /* Green Pipe style for Event Name box */
        .header-box.stretch .header-content {
            background: linear-gradient(180deg,
                #000 0%, #000 4px,
                #7dff7d 4px, #7dff7d 8px,
                #00b800 8px, #00b800 12px,
                #43b047 12px, #43b047 calc(100% - 12px),
                #00b800 calc(100% - 12px), #00b800 calc(100% - 8px),
                #7dff7d calc(100% - 8px), #7dff7d calc(100% - 4px),
                #000 calc(100% - 4px), #000 100%
            );
            border: 4px solid #000;
            border-radius: 0;
            box-shadow:
                inset 4px 0 0 #7dff7d,
                inset -4px 0 0 #007800,
                0 4px 8px var(--shadow-color);
            position: relative;
        }

        /* Pipe end caps */
        .header-box.stretch .header-content::before,
        .header-box.stretch .header-content::after {
            content: "";
            position: absolute;
            top: -8px;
            width: 20px;
            height: calc(100% + 16px);
            background: linear-gradient(90deg,
                #000 0%, #000 2px,
                #7dff7d 2px, #7dff7d 6px,
                #43b047 6px, #43b047 14px,
                #007800 14px, #007800 18px,
                #000 18px, #000 20px
            );
            z-index: 2;
        }

        .header-box.stretch .header-content::before {
            left: -4px;
            border-radius: 4px 0 0 4px;
        }

        .header-box.stretch .header-content::after {
            right: -4px;
            border-radius: 0 4px 4px 0;
        }

        .header-content.visible {
            animation: blockDrop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        .header-content.hiding {
            animation: blockRise 0.3s ease-in forwards;
        }

        #eventBox .header-content.visible { animation-delay: 0s; }
        #heatBox .header-content.visible { animation-delay: 0.1s; }
        #nameBox .header-content.visible { animation-delay: 0.2s; }

        /* Explode animation for Event/Heat number changes */
        #eventBox .header-content.exploding,
        #heatBox .header-content.exploding {
            animation: explode 0.3s ease-out forwards !important;
        }

        #eventBox .header-content.appearing,
        #heatBox .header-content.appearing {
            animation: appear 0.3s ease-out forwards !important;
        }

        #eventBox .header-content.appeared,
        #heatBox .header-content.appeared {
            animation: none !important;
            transform: translateY(0);
            opacity: 1;
        }

        @keyframes explode {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(0) scale(0); opacity: 0; }
        }

        @keyframes appear {
            0% { transform: translateY(-30px) scale(0.5); opacity: 0; }
            100% { transform: translateY(0) scale(1); opacity: 1; }
        }

        @keyframes blockDrop {
            0% { transform: translateY(-100%); opacity: 0; }
            60% { transform: translateY(10%); opacity: 1; }
            100% { transform: translateY(0); opacity: 1; }
        }

        @keyframes blockRise {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-100%); opacity: 0; }
        }

        .label {
            font-size: 0.7rem;
            color: #000;
            text-shadow: 1px 1px 0 rgba(255,255,255,0.5);
            margin-right: 8px;
        }

        .value {
            font-size: 1.2rem;
            color: #fff;
            text-shadow: 2px 2px 0 #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000;
        }

        .event-name {
            font-size: 1.4rem;
            color: var(--color-gold);
            text-shadow: 2px 2px 0 #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000;
            position: relative;
            z-index: 1;
        }

        .event-name-copy {
            font-size: 1.4rem;
            color: var(--color-gold);
            text-shadow: 2px 2px 0 #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000;
        }

        /* Pipe needs higher z-index so Mario runs behind it */
        #nameBox { position: relative; z-index: 10; }
        #nameBox .header-content { position: relative; z-index: 10; }

        /* Mario running sprite */
        .mario-runner {
            position: absolute;
            width: 64px;
            height: 64px;
            bottom: 5px;
            left: -70px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 16'%3E%3C!-- Frame 1: Right leg forward --%3E%3Cg transform='translate(0,0)'%3E%3Crect fill='%23e52521' x='3' y='0' width='5' height='1'/%3E%3Crect fill='%23e52521' x='2' y='1' width='9' height='1'/%3E%3Crect fill='%23000' x='2' y='2' width='3' height='1'/%3E%3Crect fill='%23ffb266' x='5' y='2' width='2' height='1'/%3E%3Crect fill='%23000' x='7' y='2' width='1' height='1'/%3E%3Crect fill='%23ffb266' x='8' y='2' width='1' height='1'/%3E%3Crect fill='%23000' x='1' y='3' width='1' height='1'/%3E%3Crect fill='%23ffb266' x='2' y='3' width='1' height='1'/%3E%3Crect fill='%23000' x='3' y='3' width='1' height='1'/%3E%3Crect fill='%23ffb266' x='4' y='3' width='3' height='1'/%3E%3Crect fill='%23000' x='7' y='3' width='1' height='1'/%3E%3Crect fill='%23ffb266' x='8' y='3' width='3' height='1'/%3E%3Crect fill='%23000' x='1' y='4' width='1' height='1'/%3E%3Crect fill='%23ffb266' x='2' y='4' width='1' height='1'/%3E%3Crect fill='%23000' x='3' y='4' width='2' height='1'/%3E%3Crect fill='%23ffb266' x='5' y='4' width='3' height='1'/%3E%3Crect fill='%23000' x='8' y='4' width='1' height='1'/%3E%3Crect fill='%23ffb266' x='9' y='4' width='3' height='1'/%3E%3Crect fill='%23000' x='2' y='5' width='2' height='1'/%3E%3Crect fill='%23ffb266' x='4' y='5' width='5' height='1'/%3E%3Crect fill='%23000' x='9' y='5' width='3' height='1'/%3E%3Crect fill='%23ffb266' x='4' y='6' width='4' height='1'/%3E%3Crect fill='%23e52521' x='2' y='7' width='2' height='1'/%3E%3Crect fill='%23049cd8' x='4' y='7' width='3' height='1'/%3E%3Crect fill='%23e52521' x='7' y='7' width='2' height='1'/%3E%3Crect fill='%23e52521' x='1' y='8' width='3' height='1'/%3E%3Crect fill='%23049cd8' x='4' y='8' width='5' height='1'/%3E%3Crect fill='%23e52521' x='9' y='8' width='3' height='1'/%3E%3Crect fill='%23049cd8' x='2' y='9' width='3' height='1'/%3E%3Crect fill='%23fbd000' x='5' y='9' width='1' height='1'/%3E%3Crect fill='%23049cd8' x='6' y='9' width='3' height='1'/%3E%3Crect fill='%23fbd000' x='9' y='9' width='1' height='1'/%3E%3Crect fill='%23049cd8' x='10' y='9' width='2' height='1'/%3E%3Crect fill='%23049cd8' x='2' y='10' width='4' height='1'/%3E%3Crect fill='%23049cd8' x='8' y='10' width='4' height='1'/%3E%3Crect fill='%23ffb266' x='1' y='11' width='2' height='1'/%3E%3Crect fill='%23000' x='3' y='11' width='3' height='1'/%3E%3Crect fill='%23ffb266' x='10' y='11' width='2' height='1'/%3E%3Crect fill='%23000' x='0' y='12' width='1' height='1'/%3E%3Crect fill='%23804000' x='1' y='12' width='2' height='1'/%3E%3Crect fill='%23000' x='3' y='12' width='1' height='1'/%3E%3Crect fill='%23000' x='10' y='12' width='1' height='1'/%3E%3Crect fill='%23804000' x='11' y='12' width='2' height='1'/%3E%3Crect fill='%23000' x='13' y='12' width='1' height='1'/%3E%3Crect fill='%23000' x='0' y='13' width='4' height='1'/%3E%3Crect fill='%23000' x='10' y='13' width='4' height='1'/%3E%3C/g%3E%3C!-- Frame 2: Left leg forward --%3E%3Cg transform='translate(16,0)'%3E%3Crect fill='%23e52521' x='3' y='0' width='5' height='1'/%3E%3Crect fill='%23e52521' x='2' y='1' width='9' height='1'/%3E%3Crect fill='%23000' x='2' y='2' width='3' height='1'/%3E%3Crect fill='%23ffb266' x='5' y='2' width='2' height='1'/%3E%3Crect fill='%23000' x='7' y='2' width='1' height='1'/%3E%3Crect fill='%23ffb266' x='8' y='2' width='1' height='1'/%3E%3Crect fill='%23000' x='1' y='3' width='1' height='1'/%3E%3Crect fill='%23ffb266' x='2' y='3' width='1' height='1'/%3E%3Crect fill='%23000' x='3' y='3' width='1' height='1'/%3E%3Crect fill='%23ffb266' x='4' y='3' width='3' height='1'/%3E%3Crect fill='%23000' x='7' y='3' width='1' height='1'/%3E%3Crect fill='%23ffb266' x='8' y='3' width='3' height='1'/%3E%3Crect fill='%23000' x='1' y='4' width='1' height='1'/%3E%3Crect fill='%23ffb266' x='2' y='4' width='1' height='1'/%3E%3Crect fill='%23000' x='3' y='4' width='2' height='1'/%3E%3Crect fill='%23ffb266' x='5' y='4' width='3' height='1'/%3E%3Crect fill='%23000' x='8' y='4' width='1' height='1'/%3E%3Crect fill='%23ffb266' x='9' y='4' width='3' height='1'/%3E%3Crect fill='%23000' x='2' y='5' width='2' height='1'/%3E%3Crect fill='%23ffb266' x='4' y='5' width='5' height='1'/%3E%3Crect fill='%23000' x='9' y='5' width='3' height='1'/%3E%3Crect fill='%23ffb266' x='4' y='6' width='4' height='1'/%3E%3Crect fill='%23e52521' x='2' y='7' width='2' height='1'/%3E%3Crect fill='%23049cd8' x='4' y='7' width='3' height='1'/%3E%3Crect fill='%23e52521' x='7' y='7' width='2' height='1'/%3E%3Crect fill='%23e52521' x='1' y='8' width='3' height='1'/%3E%3Crect fill='%23049cd8' x='4' y='8' width='5' height='1'/%3E%3Crect fill='%23e52521' x='9' y='8' width='3' height='1'/%3E%3Crect fill='%23049cd8' x='2' y='9' width='3' height='1'/%3E%3Crect fill='%23fbd000' x='5' y='9' width='1' height='1'/%3E%3Crect fill='%23049cd8' x='6' y='9' width='3' height='1'/%3E%3Crect fill='%23fbd000' x='9' y='9' width='1' height='1'/%3E%3Crect fill='%23049cd8' x='10' y='9' width='2' height='1'/%3E%3Crect fill='%23049cd8' x='3' y='10' width='3' height='1'/%3E%3Crect fill='%23049cd8' x='7' y='10' width='3' height='1'/%3E%3Crect fill='%23000' x='5' y='11' width='4' height='1'/%3E%3Crect fill='%23ffb266' x='3' y='11' width='2' height='1'/%3E%3Crect fill='%23ffb266' x='9' y='11' width='2' height='1'/%3E%3Crect fill='%23000' x='2' y='12' width='1' height='1'/%3E%3Crect fill='%23804000' x='3' y='12' width='2' height='1'/%3E%3Crect fill='%23000' x='5' y='12' width='1' height='1'/%3E%3Crect fill='%23000' x='8' y='12' width='1' height='1'/%3E%3Crect fill='%23804000' x='9' y='12' width='2' height='1'/%3E%3Crect fill='%23000' x='11' y='12' width='1' height='1'/%3E%3Crect fill='%23000' x='2' y='13' width='4' height='1'/%3E%3Crect fill='%23000' x='8' y='13' width='4' height='1'/%3E%3C/g%3E%3C!-- Frame 3: Legs together --%3E%3Cg transform='translate(32,0)'%3E%3Crect fill='%23e52521' x='3' y='0' width='5' height='1'/%3E%3Crect fill='%23e52521' x='2' y='1' width='9' height='1'/%3E%3Crect fill='%23000' x='2' y='2' width='3' height='1'/%3E%3Crect fill='%23ffb266' x='5' y='2' width='2' height='1'/%3E%3Crect fill='%23000' x='7' y='2' width='1' height='1'/%3E%3Crect fill='%23ffb266' x='8' y='2' width='1' height='1'/%3E%3Crect fill='%23000' x='1' y='3' width='1' height='1'/%3E%3Crect fill='%23ffb266' x='2' y='3' width='1' height='1'/%3E%3Crect fill='%23000' x='3' y='3' width='1' height='1'/%3E%3Crect fill='%23ffb266' x='4' y='3' width='3' height='1'/%3E%3Crect fill='%23000' x='7' y='3' width='1' height='1'/%3E%3Crect fill='%23ffb266' x='8' y='3' width='3' height='1'/%3E%3Crect fill='%23000' x='1' y='4' width='1' height='1'/%3E%3Crect fill='%23ffb266' x='2' y='4' width='1' height='1'/%3E%3Crect fill='%23000' x='3' y='4' width='2' height='1'/%3E%3Crect fill='%23ffb266' x='5' y='4' width='3' height='1'/%3E%3Crect fill='%23000' x='8' y='4' width='1' height='1'/%3E%3Crect fill='%23ffb266' x='9' y='4' width='3' height='1'/%3E%3Crect fill='%23000' x='2' y='5' width='2' height='1'/%3E%3Crect fill='%23ffb266' x='4' y='5' width='5' height='1'/%3E%3Crect fill='%23000' x='9' y='5' width='3' height='1'/%3E%3Crect fill='%23ffb266' x='4' y='6' width='4' height='1'/%3E%3Crect fill='%23e52521' x='2' y='7' width='2' height='1'/%3E%3Crect fill='%23049cd8' x='4' y='7' width='3' height='1'/%3E%3Crect fill='%23e52521' x='7' y='7' width='2' height='1'/%3E%3Crect fill='%23e52521' x='1' y='8' width='3' height='1'/%3E%3Crect fill='%23049cd8' x='4' y='8' width='5' height='1'/%3E%3Crect fill='%23e52521' x='9' y='8' width='3' height='1'/%3E%3Crect fill='%23049cd8' x='3' y='9' width='2' height='1'/%3E%3Crect fill='%23fbd000' x='5' y='9' width='1' height='1'/%3E%3Crect fill='%23049cd8' x='6' y='9' width='2' height='1'/%3E%3Crect fill='%23fbd000' x='8' y='9' width='1' height='1'/%3E%3Crect fill='%23049cd8' x='9' y='9' width='2' height='1'/%3E%3Crect fill='%23049cd8' x='4' y='10' width='5' height='1'/%3E%3Crect fill='%23ffb266' x='4' y='11' width='2' height='1'/%3E%3Crect fill='%23ffb266' x='7' y='11' width='2' height='1'/%3E%3Crect fill='%23000' x='3' y='12' width='1' height='1'/%3E%3Crect fill='%23804000' x='4' y='12' width='2' height='1'/%3E%3Crect fill='%23000' x='6' y='12' width='1' height='1'/%3E%3Crect fill='%23000' x='6' y='12' width='1' height='1'/%3E%3Crect fill='%23804000' x='7' y='12' width='2' height='1'/%3E%3Crect fill='%23000' x='9' y='12' width='1' height='1'/%3E%3Crect fill='%23000' x='3' y='13' width='3' height='1'/%3E%3Crect fill='%23000' x='7' y='13' width='3' height='1'/%3E%3C/g%3E%3C/svg%3E");
            background-size: 192px 64px;
            background-repeat: no-repeat;
            background-position: 0 0;
            image-rendering: pixelated;
            opacity: 0;
            pointer-events: none;
            z-index: 5;
        }

        .mario-runner.running {
            animation: marioRun 5s linear forwards, marioLegs 0.15s steps(1) infinite;
        }

        @keyframes marioRun {
            0% { left: -70px; opacity: 1; }
            100% { left: calc(100% + 150px); opacity: 1; }
        }

        @keyframes marioLegs {
            0% { background-position: 0 0; }
            33.33% { background-position: -64px 0; }
            66.66% { background-position: -128px 0; }
        }
    </style>
</head>
<body>
    <!-- Placeholder shown until first data received -->
    <div class="placeholder-container" id="placeholder">
        <div class="placeholder-box event header-content visible">
            <span class="placeholder-text">Waiting...</span>
        </div>
        <div class="placeholder-box heat header-content visible">
            <span class="placeholder-text">Waiting...</span>
        </div>
        <div class="placeholder-box name header-content visible">
            <span class="placeholder-text">Waiting for data...</span>
        </div>
        <div class="placeholder-box timer header-content visible">
            <span class="placeholder-text">0:00.0</span>
        </div>
    </div>

    <div class="header-container">
        <div class="header-box fixed" id="eventBox">
            <div class="header-content" id="eventContent">
                <span class="label">Event</span>
                <span class="value" id="eventNumber"></span>
            </div>
        </div>
        <div class="header-box fixed" id="heatBox">
            <div class="header-content" id="heatContent">
                <span class="label">Heat</span>
                <span class="value" id="heatNumber"></span>
            </div>
        </div>
        <div class="header-box stretch" id="nameBox">
            <div class="header-content" id="nameContent">
                <div class="event-name-wrapper" id="eventNameWrapper">
                    <div class="event-name-track" id="eventNameTrack">
                        <span class="event-name" id="eventName"></span>
                        <span class="event-name event-name-copy" id="eventNameCopy"></span>
                    </div>
                </div>
            </div>
        </div>
        <!-- Empty spacer where timer used to be -->
        <div class="header-box fixed" id="timerBox" style="visibility: hidden;"></div>
        <div class="mario-runner" id="marioRunner"></div>
    </div>

    <script src="../../js/overlay-core.js"></script>
    <script src="../../js/header-overlay.js"></script>
    <script>
        // Mario-specific: trigger runner on event change
        let marioRunning = false;
        function triggerMarioRun() {
            if (marioRunning) return;
            const mario = document.getElementById('marioRunner');
            marioRunning = true;
            mario.classList.remove('running');
            void mario.offsetWidth; // Force reflow
            mario.classList.add('running');
            setTimeout(() => {
                mario.classList.remove('running');
                marioRunning = false;
            }, 5000);
        }

        SwimOverlay.onEventChange = triggerMarioRun;
        SwimOverlay.init({ onData: processHeaderData });
    </script>
</body>
</html>
